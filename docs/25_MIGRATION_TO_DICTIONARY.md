# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ 100% —Å–ª–æ–≤–∞—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (30.12.2025)

## üìã –¶–µ–ª—å

–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–æ–≤–∞—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `ParameterDictionaryService`
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ª–∏–∞—Å–æ–≤
- ‚úÖ –£–±—Ä–∞—Ç—å `ParameterNameMapper` (legacy fallback)
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥–≤–æ–π–Ω—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –≤ Repository
- ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–¥ –∏ –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚ö†Ô∏è –î–≤–æ–π–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (SearchEngine + Repository)
- ‚ö†Ô∏è Fallback –Ω–∞ ParameterNameMapper
- ‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –∫–æ–¥–∞

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ –ï–¥–∏–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –≤ SearchEngine
- ‚úÖ 100% —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å –∏–∑ –ë–î
- ‚úÖ –í—ã—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤)
- ‚úÖ –ü—Ä–æ—â–µ –∫–æ–¥ –∏ –ª–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –ë–æ–ª—å—à–µ –∞–ª–∏–∞—Å–æ–≤ = –ª—É—á—à–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:

```
SearchEngine.search()
    ‚Üì
QueryParameterNormalizer.normalizeQuery()
    ‚îú‚îÄ ParameterDictionaryService  ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    ‚îú‚îÄ UnitParser                  ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    ‚îî‚îÄ EnumMapper                  ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    ‚Üì
–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π SearchQuery
    ‚Üì
EquipmentRepository.fullTextSearch()
    ‚îú‚îÄ normalizeParameter()        ‚ö†Ô∏è –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï!
    ‚îÇ   ‚îú‚îÄ ParameterDictionaryService  (—Å–Ω–æ–≤–∞!)
    ‚îÇ   ‚îî‚îÄ ParameterNameMapper     ‚ö†Ô∏è LEGACY FALLBACK
    ‚îî‚îÄ SQL –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ
```

### –ü—Ä–æ–±–ª–µ–º—ã:
1. **–î–≤–æ–π–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –¥–≤–∞–∂–¥—ã
2. **Legacy fallback** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–π ParameterNameMapper
3. **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–æ–¥ –≤ Repository

---

## üì¶ –≠—Ç–∞–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ ‚úÖ

**–§–∞–π–ª:** `src/scripts/seed-parameter-dictionary-complete.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω—ã –í–°–ï –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ ParameterNameMapper
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–ª–∏–∞—Å—ã (—Ä—É—Å—Å–∫–∏–µ + –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ + –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (common, excavator, crane, bulldozer, loader)

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `excavation_depth_mm` - 20+ –∞–ª–∏–∞—Å–æ–≤
- `bucket_capacity_m3` - 15+ –∞–ª–∏–∞—Å–æ–≤
- `operating_weight_t` - 20+ –∞–ª–∏–∞—Å–æ–≤
- `lifting_capacity_t` - 15+ –∞–ª–∏–∞—Å–æ–≤
- `lifting_height_m` - 18+ –∞–ª–∏–∞—Å–æ–≤
- `boom_reach_m` - 15+ –∞–ª–∏–∞—Å–æ–≤
- `boom_length_m` - 12+ –∞–ª–∏–∞—Å–æ–≤
- `engine_power_kw` - 20+ –∞–ª–∏–∞—Å–æ–≤
- `fuel_type` - 12+ –∞–ª–∏–∞—Å–æ–≤ (enum)
- `drive_type` - 15+ –∞–ª–∏–∞—Å–æ–≤ (enum)
- `blade_capacity_m3` - 12+ –∞–ª–∏–∞—Å–æ–≤
- `loader_bucket_capacity_m3` - 10+ –∞–ª–∏–∞—Å–æ–≤
- `capacity_tph` - 12+ –∞–ª–∏–∞—Å–æ–≤
- `year` - 10+ –∞–ª–∏–∞—Å–æ–≤
- `travel_speed_kmh` - 10+ –∞–ª–∏–∞—Å–æ–≤
- `fuel_tank_capacity_l` - 8+ –∞–ª–∏–∞—Å–æ–≤

**–ò—Ç–æ–≥–æ:** 16 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, ~200+ –∞–ª–∏–∞—Å–æ–≤

**–ó–∞–ø—É—Å–∫:**
```bash
npx tsx src/scripts/seed-parameter-dictionary-complete.ts
```

---

### –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Repository ‚è≥

**–§–∞–π–ª:** `src/repository/equipment.repository.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

#### 2.1. –£–ø—Ä–æ—Å—Ç–∏—Ç—å `normalizeParameter()` - —É–±—Ä–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é

**–ë—ã–ª–æ (—Å—Ç—Ä–æ–∫–∏ 107-169):**
```typescript
private normalizeParameter(key: string, value: string | number): {
  paramKey: string;
  value: number | string;
  operator: '=' | '>=' | '<=';
  sqlCast: string;
} | null {
  // 1. –ü–†–ò–û–†–ò–¢–ï–¢: –ü—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å –∏–∑ –ë–î
  if (this.dictionaryService) {
    const paramDef = this.dictionaryService.findCanonicalKey(baseName);
    // ... –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å
  }
  
  // 2. FALLBACK: ParameterNameMapper
  const mapped = ParameterNameMapper.mapParameterName(key);
  // ... fallback –º–∞–ø–ø–∏–Ω–≥
}
```

**–°—Ç–∞–ª–æ:**
```typescript
private buildParameterCondition(key: string, value: string | number): {
  paramKey: string;
  value: number | string;
  operator: '=' | '>=' | '<=';
  sqlCast: string;
} | null {
  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –£–ñ–ï –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ SearchEngine
  // –ü—Ä–æ—Å—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ cast
  
  let operator: '=' | '>=' | '<=' = '=';
  let sqlCast = typeof value === 'number' ? '::numeric' : '::text';
  let paramKey = key;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏–∑ —Å—É—Ñ—Ñ–∏–∫—Å–∞
  if (key.endsWith('_min')) {
    operator = '>=';
    paramKey = key.slice(0, -4);
  } else if (key.endsWith('_max')) {
    operator = '<=';
    paramKey = key.slice(0, -4);
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π)
  if (!this.validateParameterKey(paramKey)) {
    console.warn(`[Security] Invalid parameter key: ${paramKey}`);
    return null;
  }

  return { paramKey, value, operator, sqlCast };
}
```

#### 2.2. –û–±–Ω–æ–≤–∏—Ç—å `fullTextSearch()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥

**–ë—ã–ª–æ (—Å—Ç—Ä–æ–∫–∏ 214-236):**
```typescript
for (const [key, value] of Object.entries(query.parameters)) {
  const normalized = this.normalizeParameter(key, value);  // ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
  if (!normalized) continue;
  
  const { paramKey, value: normalizedValue, operator, sqlCast } = normalized;
  // ... SQL –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ
}
```

**–°—Ç–∞–ª–æ:**
```typescript
for (const [key, value] of Object.entries(query.parameters)) {
  const condition = this.buildParameterCondition(key, value);  // ‚úÖ –ë–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
  if (!condition) continue;
  
  const { paramKey, value: conditionValue, operator, sqlCast } = condition;
  
  // SQL –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π
  values.push(paramKey, conditionValue);
  const keyIndex = values.length - 1;
  const valueIndex = values.length;
  
  whereParts.push(
    `(main_parameters->>$${keyIndex})${sqlCast} ${operator} $${valueIndex}`
  );
}
```

---

### –≠—Ç–∞–ø 3: –£–¥–∞–ª–µ–Ω–∏–µ ParameterNameMapper üóëÔ∏è

**–§–∞–π–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:** `src/normalization/parameter-name-mapper.ts`

**–ü–æ—á–µ–º—É –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å:**
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–ø–µ—Ä—å –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
- ‚úÖ –í—Å–µ –∞–ª–∏–∞—Å—ã –ø–æ–∫—Ä—ã—Ç—ã
- ‚úÖ Fallback –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω

**–û–±–Ω–æ–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã:**

**–§–∞–π–ª:** `src/normalization/index.ts`

```typescript
// –ë—ã–ª–æ:
export { ParameterNameMapper } from "./parameter-name-mapper";

// –°—Ç–∞–ª–æ:
// –£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω
```

---

### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ ‚úÖ

**–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```typescript
// src/scripts/test-dictionary-migration.ts

import { ParameterDictionaryService } from "../normalization";

async function testDictionaryMigration() {
  console.log("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞\n");
  
  const dictionaryService = new ParameterDictionaryService();
  await dictionaryService.loadDictionary();
  
  // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  const testParams = [
    "–≥–ª—É–±–∏–Ω–∞_–∫–æ–ø–∞–Ω–∏—è",
    "–æ–±—ä–µ–º_–∫–æ–≤—à–∞",
    "–≤–µ—Å",
    "–º–∞—Å—Å–∞",
    "–≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å",
    "–º–æ—â–Ω–æ—Å—Ç—å",
    "–º–æ—â–Ω–æ—Å—Ç—å_–¥–≤–∏–≥–∞—Ç–µ–ª—è",
    "–≤—ã—Å–æ—Ç–∞_–ø–æ–¥—ä–µ–º–∞",
    "–≤—ã–ª–µ—Ç_—Å—Ç—Ä–µ–ª—ã",
    "—Ç–∏–ø_—Ç–æ–ø–ª–∏–≤–∞",
    "—Ç–∏–ø_–ø–∏—Ç–∞–Ω–∏—è",
    // ... –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
  ];
  
  let found = 0;
  let notFound = 0;
  
  for (const param of testParams) {
    const result = dictionaryService.findCanonicalKey(param);
    if (result) {
      console.log(`‚úÖ "${param}" ‚Üí ${result.key}`);
      found++;
    } else {
      console.error(`‚ùå "${param}" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–æ–≤–∞—Ä–µ!`);
      notFound++;
    }
  }
  
  console.log(`\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:`);
  console.log(`   –ù–∞–π–¥–µ–Ω–æ: ${found}`);
  console.log(`   –ù–µ –Ω–∞–π–¥–µ–Ω–æ: ${notFound}`);
  console.log(`   –ü–æ–∫—Ä—ã—Ç–∏–µ: ${Math.round((found / testParams.length) * 100)}%`);
  
  if (notFound === 0) {
    console.log("\n‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∫—Ä—ã—Ç—ã —Å–ª–æ–≤–∞—Ä–µ–º!");
    console.log("üéØ –ì–æ—Ç–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–∏—é ParameterNameMapper");
  } else {
    console.log("\n‚ö†Ô∏è –ï—Å—Ç—å –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!");
    console.log("üí° –î–æ–±–∞–≤—å—Ç–µ –∞–ª–∏–∞—Å—ã –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫");
  }
}

testDictionaryMigration();
```

---

### –≠—Ç–∞–ø 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è üìö

**–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã:**

1. **`docs/24_NORMALIZATION_ANALYSIS.md`**
   - –û—Ç–º–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ ParameterNameMapper
   - –û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–æ–≤

2. **`docs/23_NORMALIZATION_INTEGRATION.md`**
   - –û–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –±–µ–∑ fallback
   - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã

3. **`docs/20_NORMALIZATION_FLOW_DIAGRAM.md`**
   - –£–±—Ä–∞—Ç—å –¥–≤–æ–π–Ω—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ –¥–∏–∞–≥—Ä–∞–º–º
   - –ü–æ–∫–∞–∑–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫

---

## üöÄ –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –®–∞–≥ 1: –†–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (–°–ï–ô–ß–ê–°) ‚úÖ

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π seed —Å–∫—Ä–∏–ø—Ç
npx tsx src/scripts/seed-parameter-dictionary-complete.ts

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
psql -d equipment_catalog -c "SELECT COUNT(*) FROM parameter_dictionary;"
psql -d equipment_catalog -c "SELECT key, label_ru, array_length(aliases, 1) as alias_count FROM parameter_dictionary ORDER BY alias_count DESC;"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- 16 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
- ~200+ –∞–ª–∏–∞—Å–æ–≤
- –ü–æ–∫—Ä—ã—Ç–∏–µ 100%

---

### –®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ ‚úÖ

```bash
# –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
npx tsx src/scripts/test-dictionary-migration.ts
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–π–¥–µ–Ω—ã
- –ü–æ–∫—Ä—ã—Ç–∏–µ 100%
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —É–¥–∞–ª–µ–Ω–∏—é fallback

---

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å Repository üîß

```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp src/repository/equipment.repository.ts src/repository/equipment.repository.ts.backup

# 2. –í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å–º. –≠—Ç–∞–ø 2 –≤—ã—à–µ)

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
npm test
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

---

### –®–∞–≥ 4: –£–¥–∞–ª–∏—Ç—å ParameterNameMapper üóëÔ∏è

```bash
# 1. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª
rm src/normalization/parameter-name-mapper.ts

# 2. –û–±–Ω–æ–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã
# –£–¥–∞–ª–∏—Ç—å –∏–∑ src/normalization/index.ts

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
grep -r "ParameterNameMapper" src/
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª —É–¥–∞–ª–µ–Ω
- –ù–∏–∫–∞–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é üìù

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (—Å–º. –≠—Ç–∞–ø 5 –≤—ã—à–µ)
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –û–±—Ä–∞—â–µ–Ω–∏–π –∫ —Å–ª–æ–≤–∞—Ä—é | 2x | 1x | **50% ‚Üì** |
| –ü–∞—Ä—Å–∏–Ω–≥ –µ–¥–∏–Ω–∏—Ü | 2x | 1x | **50% ‚Üì** |
| –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ | ~100ms | ~70ms | **30% ‚Üì** |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | 300+ | 200 | **33% ‚Üì** |

### –ü–æ–∫—Ä—ã—Ç–∏–µ:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | 10 | 16 | **60% ‚Üë** |
| –ê–ª–∏–∞—Å–æ–≤ | 70 | 200+ | **180% ‚Üë** |
| –ü–æ–∫—Ä—ã—Ç–∏–µ | ~80% | 100% | **20% ‚Üë** |

---

## üß™ –¢–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –¢–µ—Å—Ç 1: –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å

```typescript
const testParams = [
  { input: "–≥–ª—É–±–∏–Ω–∞_–∫–æ–ø–∞–Ω–∏—è", expected: "excavation_depth_mm" },
  { input: "–≤–µ—Å", expected: "operating_weight_t" },
  { input: "–º–æ—â–Ω–æ—Å—Ç—å", expected: "engine_power_kw" },
  { input: "–≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å", expected: "lifting_capacity_t" },
  // ... –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
];

for (const test of testParams) {
  const result = dictionaryService.findCanonicalKey(test.input);
  assert(result?.key === test.expected);
}
```

### –¢–µ—Å—Ç 2: –ö–æ–Ω–≤–µ—Ä—Å–∏—è –µ–¥–∏–Ω–∏—Ü

```typescript
const testCases = [
  { param: "–≤–µ—Å", value: "20 —Ç–æ–Ω–Ω", expected: 20 },
  { param: "–º–æ—â–Ω–æ—Å—Ç—å", value: "132 –ª.—Å.", expected: 97.152 },
  { param: "–≥–ª—É–±–∏–Ω–∞_–∫–æ–ø–∞–Ω–∏—è", value: "5 –º", expected: 5000 },
];

for (const test of testCases) {
  const paramDef = dictionaryService.findCanonicalKey(test.param);
  const parsed = unitParser.parseValue(test.value, paramDef.unit);
  assert(parsed === test.expected);
}
```

### –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```typescript
const query: SearchQuery = {
  text: "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä",
  parameters: {
    "–≥–ª—É–±–∏–Ω–∞_–∫–æ–ø–∞–Ω–∏—è_min": "3000 –º–º",
    "–≤–µ—Å_max": "25 —Ç–æ–Ω–Ω",
  }
};

const results = await searchEngine.search(query);
assert(results.items.length > 0);
```

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ù–µ–ø–æ–∫—Ä—ã—Ç—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≤ —Å–ª–æ–≤–∞—Ä–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ –¢–µ—Å—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º fallback
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production

### –†–∏—Å–∫ 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è fallback

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- ‚úÖ Rollback plan (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è Repository)

### –†–∏—Å–∫ 3: –†–µ–≥—Ä–µ—Å—Å–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å—Å—è

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–æ–≤—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º
- [ ] –¢–µ—Å—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100%
- [ ] Repository –æ–±–Ω–æ–≤–ª–µ–Ω (–±–µ–∑ –¥–≤–æ–π–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)
- [ ] ParameterNameMapper —É–¥–∞–ª–µ–Ω
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î
- [ ] –ì–æ—Ç–æ–≤ rollback plan

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å seed —Å–∫—Ä–∏–ø—Ç** ‚úÖ
   ```bash
   npx tsx src/scripts/seed-parameter-dictionary-complete.ts
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ**
   ```bash
   npx tsx src/scripts/test-dictionary-migration.ts
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å Repository**
   - –ó–∞–º–µ–Ω–∏—Ç—å `normalizeParameter()` –Ω–∞ `buildParameterCondition()`
   - –£–±—Ä–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é

4. **–£–¥–∞–ª–∏—Ç—å legacy –∫–æ–¥**
   ```bash
   rm src/normalization/parameter-name-mapper.ts
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã**
   ```bash
   npm test
   ```

---

## ‚ú® –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–µ—Ç:
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ** - –Ω–µ—Ç –¥–≤–æ–π–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ü—Ä–æ—â–µ** - –º–µ–Ω—å—à–µ –∫–æ–¥–∞, –ª–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–µ–µ** - 100% —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å
- ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–µ–µ** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É! üöÄ**


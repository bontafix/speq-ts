# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç search_vector –≤ –ø–æ–∏—Å–∫–µ

## üìä –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã search_vector

### 1Ô∏è‚É£ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –í–´ –î–û–ë–ê–í–õ–Ø–ï–¢–ï/–û–ë–ù–û–í–õ–Ø–ï–¢–ï –ó–ê–ü–ò–°–¨                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
INSERT INTO equipment (name, category, brand, description)
VALUES ('–ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä', '–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã', 'Cat', '...');
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL –¢–†–ò–ì–ì–ï–† —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò               ‚îÇ
‚îÇ  equipment_search_vector_trigger                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –§—É–Ω–∫—Ü–∏—è equipment_search_vector_update()                   ‚îÇ
‚îÇ  —Å–æ–∑–¥–∞—ë—Ç tsvector –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π:                       ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  search_vector =                                             ‚îÇ
‚îÇ    setweight(to_tsvector('russian', name), 'A') ||          ‚îÇ
‚îÇ    setweight(to_tsvector('russian', category), 'B') ||       ‚îÇ
‚îÇ    setweight(to_tsvector('russian', subcategory), 'B') ||    ‚îÇ
‚îÇ    setweight(to_tsvector('russian', brand), 'C') ||          ‚îÇ
‚îÇ    setweight(to_tsvector('russian', region), 'C') ||        ‚îÇ
‚îÇ    setweight(to_tsvector('russian', description), 'D')      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  search_vector —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î                              ‚îÇ
‚îÇ  –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è:                                            ‚îÇ
‚îÇ  '–≥—É—Å–µ–Ω–∏—á–Ω':1A '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':2A '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':3B 'cat':4C    ‚îÇ
‚îÇ  (A, B, C, D - –≤–µ—Å–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏)                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–∏—Å–∫–µ (–∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞)

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: **"–ù—É–∂–µ–Ω –≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä"**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å                                  ‚îÇ
‚îÇ  "–ù—É–∂–µ–Ω –≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä"                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  QuestionParser –ø–∞—Ä—Å–∏—Ç —á–µ—Ä–µ–∑ LLM                             ‚îÇ
‚îÇ  ‚Üí SearchQuery { text: "–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" }            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SearchEngine.search()                                        ‚îÇ
‚îÇ  ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç fullTextSearch()                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  EquipmentRepository.fullTextSearch()                        ‚îÇ
‚îÇ  –°—Ç—Ä–æ–∫–∞ 94-95:                                               ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  WHERE search_vector @@ plainto_tsquery(                    ‚îÇ
‚îÇ    'russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä'                       ‚îÇ
‚îÇ  )                                                           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ORDER BY ts_rank(search_vector, ...) DESC                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫:                                ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  1. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ tsquery:                           ‚îÇ
‚îÇ     '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π' & '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä'                             ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  2. –ò—â–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ search_vector:                        ‚îÇ
‚îÇ     - –ù–∞—Ö–æ–¥–∏—Ç '–≥—É—Å–µ–Ω–∏—á–Ω':1A –∏ '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':2A              ‚îÇ
‚îÇ     - –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (ts_rank)                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  3. –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é                        ‚îÇ
‚îÇ  –°—Ç—Ä–∞—Ç–µ–≥–∏—è: "fts"                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∫–æ–¥–∞

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è search_vector

**–§–∞–π–ª:** `src/repository/equipment.repository.ts`

```typescript
async fullTextSearch(query: SearchQuery, limit: number) {
  // ...
  
  // –°—Ç—Ä–æ–∫–∞ 94: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ search_vector
  if (query.text) {
    values.push(query.text);
    const placeholder = `$${values.length}`;
    
    // –û–ø–µ—Ä–∞—Ç–æ—Ä @@ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ search_vector —Å–ª–æ–≤–∞ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
    whereParts.push(
      `search_vector @@ plainto_tsquery('russian', ${placeholder})`
    );
    
    // ts_rank –≤—ã—á–∏—Å–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (0.0 - 1.0)
    rankExpression = `ts_rank(
      search_vector, 
      plainto_tsquery('russian', ${placeholder})
    )`;
  }
  
  // –°—Ç—Ä–æ–∫–∞ 127: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
  ORDER BY ${rankExpression} DESC, name ASC
}
```

### SQL –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

```sql
SELECT
  id::text AS id,
  name,
  category,
  brand,
  price,
  main_parameters AS "mainParameters"
FROM equipment
WHERE is_active = true
  AND search_vector @@ plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')
ORDER BY 
  ts_rank(search_vector, plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')) DESC,
  name ASC
LIMIT 10;
```

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Full-Text Search

### –û–ø–µ—Ä–∞—Ç–æ—Ä `@@` (—Å–æ–¥–µ—Ä–∂–∏—Ç)

```sql
search_vector @@ plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- `plainto_tsquery()` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `'–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä'` ‚Üí `'–≥—É—Å–µ–Ω–∏—á–Ω—ã–π' & '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä'` (–æ–±–∞ —Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å)
- `@@` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ `search_vector` —ç—Ç–∏ —Å–ª–æ–≤–∞

**–ü—Ä–∏–º–µ—Ä:**
```sql
-- search_vector = '–≥—É—Å–µ–Ω–∏—á–Ω':1A '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':2A 'cat':4C
-- –ó–∞–ø—Ä–æ—Å: '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä'
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ TRUE (—Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–∞ —Å–ª–æ–≤–∞)
```

### –§—É–Ω–∫—Ü–∏—è `ts_rank()` (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)

```sql
ts_rank(search_vector, plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä'))
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (0.0 - 1.0)
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–µ—Å–∞ (A > B > C > D)
- –ß–µ–º –≤—ã—à–µ –≤–µ—Å –∏ —á–∞—â–µ —Å–ª–æ–≤–æ, —Ç–µ–º –≤—ã—à–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å

**–ü—Ä–∏–º–µ—Ä:**
```sql
-- –ó–∞–ø–∏—Å—å 1: name='–ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä' (–≤–µ—Å A)
--   ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å = 0.8 (–≤—ã—Å–æ–∫–∞—è, —Å–ª–æ–≤–∞ –≤ name)

-- –ó–∞–ø–∏—Å—å 2: description='...—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä...' (–≤–µ—Å D)
--   ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å = 0.2 (–Ω–∏–∑–∫–∞—è, —Å–ª–æ–≤–∞ –≤ description)
```

## üìà –í–µ—Å–∞ –ø–æ–ª–µ–π (–≤–∞–∂–Ω–æ—Å—Ç—å)

–¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞—ë—Ç `search_vector` —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏:

| –ü–æ–ª–µ | –í–µ—Å | –í–∞–∂–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|--------|
| `name` | A | –°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è | "–ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" |
| `category`, `subcategory` | B | –í—ã—Å–æ–∫–∞—è | "–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã", "–ì—É—Å–µ–Ω–∏—á–Ω—ã–µ" |
| `brand`, `region` | C | –°—Ä–µ–¥–Ω—è—è | "Caterpillar", "–ú–æ—Å–∫–≤–∞" |
| `description` | D | –ù–∏–∑–∫–∞—è | "–ú–æ—â–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å..." |

**–ó–∞—á–µ–º –≤–µ—Å–∞?**
- –°–ª–æ–≤–æ –≤ `name` –≤–∞–∂–Ω–µ–µ, —á–µ–º –≤ `description`
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º –≤ `name` –±—É–¥—É—Ç –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ

## üîÑ –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

```sql
INSERT INTO equipment (name, category, brand, description)
VALUES (
  '–ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä Cat 320D',
  '–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã',
  'Caterpillar',
  '–ú–æ—â–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä –¥–ª—è –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç'
);
```

### –®–∞–≥ 2: –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞—ë—Ç search_vector

```sql
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è:
search_vector = 
  '–≥—É—Å–µ–Ω–∏—á–Ω':1A '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':2A 'cat':3A '320d':4A  -- name (–≤–µ—Å A)
  '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':5B                                    -- category (–≤–µ—Å B)
  'caterpillar':6C                                   -- brand (–≤–µ—Å C)
  '–º–æ—â–Ω':7D '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':8D '–∫–∞—Ä—å–µ—Ä–Ω':9D '—Ä–∞–±–æ—Ç':10D -- description (–≤–µ—Å D)
```

### –®–∞–≥ 3: –ü–æ–∏—Å–∫

```sql
-- –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä"
SELECT name, category
FROM equipment
WHERE search_vector @@ plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')
ORDER BY ts_rank(search_vector, plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')) DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∑–∞–ø–∏—Å—å (—Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–∞ —Å–ª–æ–≤–∞)
- ‚úÖ –í—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (—Å–ª–æ–≤–∞ –≤ name —Å –≤–µ—Å–æ–º A)
- ‚úÖ –ü–µ—Ä–≤–∞—è –≤ —Å–ø–∏—Å–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: search_vector vs embedding

| –ü–∞—Ä–∞–º–µ—Ç—Ä | search_vector (FTS) | embedding (Vector) |
|----------|---------------------|---------------------|
| **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ç—Ä–∏–≥–≥–µ—Ä) | –í—Ä—É—á–Ω—É—é (worker) |
| **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö** | TSVECTOR | VECTOR |
| **–ü–æ–∏—Å–∫** | –ü–æ —Å–ª–æ–≤–∞–º | –ü–æ —Å–º—ã—Å–ª—É |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π | –ë—ã—Å—Ç—Ä—ã–π |
| **–ü–æ–Ω–∏–º–∞–Ω–∏–µ** | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ |
| **–ü—Ä–∏–º–µ—Ä** | "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" ‚Üí –Ω–∞–π–¥—ë—Ç "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" | "—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –∫–æ–ø–∞–Ω–∏—è" ‚Üí –Ω–∞–π–¥—ë—Ç "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" |

## üí° –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. search_vector –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```sql
-- –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ –ª—é–±–æ–µ –ø–æ–ª–µ - —Ç—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç search_vector
UPDATE equipment 
SET name = '–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'
WHERE id = 123;
-- search_vector –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

### 2. –ò–Ω–¥–µ–∫—Å GIN —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫

```sql
-- –í –≤–∞—à–µ–π –ë–î —É–∂–µ –µ—Å—Ç—å –∏–Ω–¥–µ–∫—Å:
CREATE INDEX equipment_search_vector_idx 
  ON equipment USING gin (search_vector) 
  WHERE (is_active = true);
```

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–æ–∏—Å–∫ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–º –¥–∞–∂–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

### 3. –†—É—Å—Å–∫–∞—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è

```sql
-- PostgreSQL –ø–æ–Ω–∏–º–∞–µ—Ç —Ä—É—Å—Å–∫—É—é –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é:
-- "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" –Ω–∞–π–¥—ë—Ç: "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä", "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã", "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä–∞"
plainto_tsquery('russian', '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')
```

### 4. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫

–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:

```typescript
// –°–Ω–∞—á–∞–ª–∞ FTS (search_vector) - –±—ã—Å—Ç—Ä—ã–π –∏ —Ç–æ—á–Ω—ã–π
const ftsResults = await fullTextSearch(query, limit);

// –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞–ª–æ - –¥–æ–±–∞–≤–ª—è–µ–º vector search (embedding)
if (ftsResults.length < 3) {
  const vectorResults = await vectorSearch(query, remaining);
  // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
}
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã search_vector

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ search_vector

```sql
SELECT 
  id,
  name,
  search_vector,
  length(search_vector::text) AS vector_length
FROM equipment
WHERE is_active = true
LIMIT 5;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –≤—Ä—É—á–Ω—É—é

```sql
SELECT 
  id,
  name,
  category,
  ts_rank(search_vector, plainto_tsquery('russian', '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')) AS rank
FROM equipment
WHERE search_vector @@ plainto_tsquery('russian', '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')
  AND is_active = true
ORDER BY rank DESC
LIMIT 10;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç

```sql
-- –û—á–∏—Å—Ç–∏—Ç—å search_vector
UPDATE equipment SET search_vector = NULL WHERE id = 123;

-- –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å (—Ç—Ä–∏–≥–≥–µ—Ä –∑–∞–ø–æ–ª–Ω–∏—Ç search_vector)
UPDATE equipment SET updated_at = NOW() WHERE id = 123;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
SELECT id, search_vector IS NOT NULL FROM equipment WHERE id = 123;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å TRUE
```

## üìù –ò—Ç–æ–≥–æ

**search_vector:**
- ‚úÖ –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä PostgreSQL
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **Full-Text Search** (–ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º)
- ‚úÖ **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π** –±–ª–∞–≥–æ–¥–∞—Ä—è –∏–Ω–¥–µ–∫—Å—É GIN
- ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç **—Ä—É—Å—Å–∫—É—é –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç **–≤–µ—Å–∞ –ø–æ–ª–µ–π** (name –≤–∞–∂–Ω–µ–µ description)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ –≤ –º–µ—Ç–æ–¥–µ `fullTextSearch()`

**–í –∫–æ–¥–µ:**
- –§–∞–π–ª: `src/repository/equipment.repository.ts`
- –ú–µ—Ç–æ–¥: `fullTextSearch()` (—Å—Ç—Ä–æ–∫–∏ 85-133)
- SQL –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã: `@@` (—Å–æ–¥–µ—Ä–∂–∏—Ç), `ts_rank()` (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)


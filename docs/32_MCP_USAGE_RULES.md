# Правила использования MCP сервера для работы с БД

## Основное правило

**При работе с базой данных PostgreSQL ВСЕГДА используй MCP сервер, а не другие способы.**

## Что НЕ нужно делать

❌ **НЕ используй** прямые SQL запросы через терминал:
```bash
psql -h $PGHOST -U $PGUSER -d $PGDATABASE -c "SELECT ..."
```

❌ **НЕ используй** `run_terminal_cmd` для выполнения SQL:
```bash
run_terminal_cmd с psql командами
```

❌ **НЕ используй** код из `src/db/pg.ts` для выполнения запросов в чате с AI

## Что нужно делать

✅ **ВСЕГДА используй** MCP инструменты для работы с БД

### Доступные MCP инструменты

MCP сервер PostgreSQL предоставляет следующие инструменты:

1. **`mcp_speq-ts-postgres_query`** (или `mcp_postgres_query`)
   - Для выполнения SQL запросов
   - Используется автоматически при запросах к БД

2. **`mcp_speq-ts-postgres_list_tables`** (или `mcp_postgres_list_tables`)
   - Для получения списка таблиц
   - Используется при запросе "какие таблицы есть в базе"

3. **`mcp_speq-ts-postgres_describe_table`** (или `mcp_postgres_describe_table`)
   - Для получения схемы таблицы
   - Используется при запросе "покажи схему таблицы X"

## Примеры правильного использования

### Запрос: "Какие таблицы есть в базе данных?"
**Правильно:** Используй MCP `list_tables` инструмент
**Неправильно:** Выполнять `psql -c "\dt"` через терминал

### Запрос: "Покажи схему таблицы equipment"
**Правильно:** Используй MCP `describe_table` инструмент
**Неправильно:** Выполнять `psql -c "\d equipment"` через терминал

### Запрос: "Сколько записей в таблице equipment?"
**Правильно:** Используй MCP `query` с SQL `SELECT COUNT(*) FROM equipment`
**Неправильно:** Выполнять `psql -c "SELECT COUNT(*) FROM equipment"` через терминал

### Запрос: "Покажи первые 10 записей из таблицы equipment"
**Правильно:** Используй MCP `query` с SQL `SELECT * FROM equipment LIMIT 10`
**Неправильно:** Выполнять `psql -c "SELECT * FROM equipment LIMIT 10"` через терминал

## Как проверить, что MCP работает

1. Задай вопрос о базе данных в чате
2. Если AI отвечает на вопрос о БД, значит MCP работает
3. Если AI предлагает использовать `psql` или другие способы, значит MCP не настроен

## Если MCP не работает

1. **Проверь конфигурацию:**
   ```bash
   cat .cursor/mcp.json
   ```

2. **Перезапусти Cursor** (это критически важно!)

3. **Проверь логи MCP:**
   - Открой панель Output (View > Output)
   - Выбери канал "MCP" или "PostgreSQL"

4. **Проверь статус сервера:**
   - `Cmd/Ctrl + Shift + P` → "MCP: Show Servers"
   - Убедись, что сервер `postgres` активен

## Настройка в .cursorrules

Правила использования MCP добавлены в файл `.cursorrules` проекта. Это гарантирует, что AI-ассистент будет использовать MCP для всех запросов к БД.

## Преимущества использования MCP

1. **Безопасность:** Не нужно выполнять SQL через терминал
2. **Консистентность:** Все запросы идут через один интерфейс
3. **Удобство:** AI может автоматически использовать правильные инструменты
4. **Отладка:** Легче отслеживать запросы через MCP логи

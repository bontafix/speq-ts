# –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## üìä –¢–∞–±–ª–∏—Ü–∞ equipment

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      TABLE: equipment                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ö–æ–ª–æ–Ω–∫–∞          ‚îÇ –¢–∏–ø          ‚îÇ –ö–∞–∫ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id               ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ name             ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ category         ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ subcategory      ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ brand            ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ region           ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ description      ‚îÇ TEXT         ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ price            ‚îÇ NUMERIC      ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ main_parameters  ‚îÇ JSONB        ‚îÇ –í—Ä—É—á–Ω—É—é –ø—Ä–∏ INSERT         ‚îÇ
‚îÇ is_active        ‚îÇ BOOLEAN      ‚îÇ –í—Ä—É—á–Ω—É—é (default: true)    ‚îÇ
‚îÇ                  ‚îÇ              ‚îÇ                            ‚îÇ
‚îÇ search_vector    ‚îÇ TSVECTOR     ‚îÇ ü§ñ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò (—Ç—Ä–∏–≥–≥–µ—Ä)‚îÇ
‚îÇ embedding        ‚îÇ VECTOR(768)  ‚îÇ üë∑ –í–†–£–ß–ù–£–Æ (worker)       ‚îÇ
‚îÇ                  ‚îÇ              ‚îÇ                            ‚îÇ
‚îÇ created_at       ‚îÇ TIMESTAMP    ‚îÇ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏              ‚îÇ
‚îÇ updated_at       ‚îÇ TIMESTAMP    ‚îÇ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ç—Ä–∏–≥–≥–µ—Ä)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –¥–≤—É—Ö –ø–æ–ª–µ–π

### 1Ô∏è‚É£ search_vector (Full-Text Search)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  –ü–û–õ–ù–û–°–¢–¨–Æ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

INSERT/UPDATE equipment
         ‚Üì
   PostgreSQL Trigger
         ‚Üì
   equipment_search_vector_update()
         ‚Üì
   –°–æ–∑–¥–∞—ë—Ç tsvector –∏–∑ –ø–æ–ª–µ–π:
   - name (–≤–µ—Å A)
   - category, subcategory (–≤–µ—Å B)
   - brand, region (–≤–µ—Å C)
   - description (–≤–µ—Å D)
         ‚Üì
   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ search_vector
         ‚Üì
   ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ FTS –ø–æ–∏—Å–∫—É!
```

**–ü—Ä–∏–º–µ—Ä:**
```sql
-- –í—ã –≤—Å—Ç–∞–≤–ª—è–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ –ë–ï–ó search_vector:
INSERT INTO equipment (id, name, category, brand)
VALUES ('exc-001', '–ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä', '–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã', 'Caterpillar');

-- PostgreSQL –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò —Å–æ–∑–¥–∞—ë—Ç search_vector:
-- search_vector = '–≥—É—Å–µ–Ω–∏—á–Ω':1A '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':2A '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':3B 'caterpillar':4C
```

### 2Ô∏è‚É£ embedding (Vector Search)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               –¢–†–ï–ë–£–ï–¢ –ó–ê–ü–£–°–ö–ê WORKER                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

npm run embed:equipment
         ‚Üì
   Worker (Node.js)
         ‚Üì
   1. –ß–∏—Ç–∞–µ—Ç –∑–∞–ø–∏—Å–∏ WHERE embedding IS NULL
         ‚Üì
   2. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª–µ–π:
      name + category + subcategory + brand + region
         ‚Üì
   3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ LLM API:
      - Ollama: POST /v1/embeddings
      - OpenAI: POST /v1/embeddings
         ‚Üì
   4. –ü–æ–ª—É—á–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä [0.123, -0.456, ...]
         ‚Üì
   5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î:
      UPDATE equipment SET embedding = '[...]'::vector
         ‚Üì
   ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É –ø–æ–∏—Å–∫—É!
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
# –®–∞–≥ 1: –í –ë–î —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–æ embedding = NULL)
psql -c "SELECT id, name, embedding IS NULL FROM equipment;"
#  id      | name                        | embedding IS NULL
# ---------+-----------------------------+------------------
#  exc-001 | –ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä       | t (true)

# –®–∞–≥ 2: –ó–∞–ø—É—Å–∫–∞–µ–º worker
npm run embed:equipment
# –û–±—Ä–∞–±–æ—Ç–∫–∞ batch: 1 –∑–∞–ø–∏—Å–µ–π...
# –ì–æ—Ç–æ–≤–æ. –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: 1.

# –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º
psql -c "SELECT id, name, embedding IS NULL FROM equipment;"
#  id      | name                        | embedding IS NULL
# ---------+-----------------------------+------------------
#  exc-001 | –ì—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä       | f (false) ‚úÖ
```

## üîç –î–≤–∞ —Ç–∏–ø–∞ –ø–æ–∏—Å–∫–∞

### FTS (Full-Text Search) - —Ä–∞–±–æ—Ç–∞–µ—Ç –°–†–ê–ó–£

```sql
SELECT id, name, category
FROM equipment
WHERE search_vector @@ plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')
ORDER BY ts_rank(search_vector, plainto_tsquery('russian', '–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä')) DESC;
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–ª–æ–≤ (—Å —É—á—ë—Ç–æ–º –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏)
- –ë—ã—Å—Ç—Ä—ã–π (–∏–Ω–¥–µ–∫—Å GIN)
- –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã

**–ü—Ä–∏–º–µ—Ä:**
- –ó–∞–ø—Ä–æ—Å: "–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" ‚Üí –Ω–∞–π–¥—ë—Ç "–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" ‚úÖ
- –ó–∞–ø—Ä–æ—Å: "—Ç–µ—Ö–Ω–∏–∫–∞ –Ω–∞ –≥—É—Å–µ–Ω–∏—Ü–∞—Ö" ‚Üí –ù–ï –Ω–∞–π–¥—ë—Ç "–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" ‚ùå

### Vector Search - —Ä–∞–±–æ—Ç–∞–µ—Ç –ü–û–°–õ–ï –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è embeddings

```sql
SELECT id, name, category
FROM equipment_vector_search('—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –∫–∞—Ä—å–µ—Ä–∞', 5);
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª –∑–∞–ø—Ä–æ—Å–∞
- –ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ –ø–æ —Å–º—ã—Å–ª—É
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ FTS (–Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –±—ã—Å—Ç—Ä–æ)

**–ü—Ä–∏–º–µ—Ä:**
- –ó–∞–ø—Ä–æ—Å: "—Ç–µ—Ö–Ω–∏–∫–∞ –Ω–∞ –≥—É—Å–µ–Ω–∏—Ü–∞—Ö" ‚Üí –Ω–∞–π–¥—ë—Ç "–≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" ‚úÖ
- –ó–∞–ø—Ä–æ—Å: "–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ–ø–∞–Ω–∏—è" ‚Üí –Ω–∞–π–¥—ë—Ç "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" ‚úÖ

## üì¶ –ß—Ç–æ —É –Ω–∞—Å –ï–°–¢–¨ –≤ –ø—Ä–æ–µ–∫—Ç–µ

### ‚úÖ –í –∫–æ–¥–µ (TypeScript/Node.js)

1. **Worker –¥–ª—è embeddings**
   - –§–∞–π–ª: `src/worker/embed-equipment.ts`
   - –ö–æ–º–∞–Ω–¥–∞: `npm run embed:equipment`
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Ollama, OpenAI, Groq

2. **Repository —Å –º–µ—Ç–æ–¥–∞–º–∏**
   - `fullTextSearch()` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç search_vector
   - `vectorSearch()` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç embedding
   - `findWithoutEmbedding()` ‚Äî –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è worker
   - `updateEmbedding()` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä –≤ –ë–î

3. **SearchEngine**
   - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫: —Å–Ω–∞—á–∞–ª–∞ FTS, –ø–æ—Ç–æ–º vector (–µ—Å–ª–∏ –º–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ENABLE_VECTOR_SEARCH=true`

### ‚úÖ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ)

1. **001_create_equipment_table.sql**
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã equipment
   - –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è search_vector
   - –§—É–Ω–∫—Ü–∏—è equipment_vector_search
   - –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã

2. **002_sample_data.sql**
   - 10 –ø—Ä–∏–º–µ—Ä–æ–≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
   - –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞

3. **migrations/README.md**
   - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ë–î

## ‚ùå –ß—Ç–æ –ù–ï –°–û–ó–î–ê–ù–û (–Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é)

### 1. PostgreSQL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º pgvector

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pgvector
sudo apt install postgresql-15-pgvector

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker
docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=pass pgvector/pgvector:pg16
```

### 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
psql -U postgres -d equipment_catalog -f migrations/001_create_equipment_table.sql
psql -U postgres -d equipment_catalog -f migrations/002_sample_data.sql
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å worker –¥–ª—è embeddings

```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ LLM –¥–æ—Å—Ç—É–ø–µ–Ω
ollama pull nomic-embed-text

# –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
npm run embed:equipment
```

## üéØ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è "—Å –Ω—É–ª—è"

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL + pgvector (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)
sudo apt install postgresql-15 postgresql-15-pgvector

# –°–æ–∑–¥–∞—Ç—å –ë–î
sudo -u postgres createdb equipment_catalog

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
cd /home/martin/pr/speq-ts
psql -U postgres -d equipment_catalog -f migrations/001_create_equipment_table.sql
psql -U postgres -d equipment_catalog -f migrations/002_sample_data.sql
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

```bash
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env:
# PGDATABASE=equipment_catalog
# PGUSER=postgres
# PGPASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
```

### –®–∞–≥ 3: –¢–µ—Å—Ç FTS (—Ä–∞–±–æ—Ç–∞–µ—Ç —É–∂–µ —Å–µ–π—á–∞—Å!)

```bash
npm start
# –í–≤–µ–¥–∏—Ç–µ: "–ù—É–∂–µ–Ω –≥—É—Å–µ–Ω–∏—á–Ω—ã–π —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä"
# –î–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ FTS
```

### –®–∞–≥ 4: –ó–∞–ø–æ–ª–Ω–∏—Ç—å embeddings

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å Ollama
ollama pull nomic-embed-text

# –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
npm run embed:equipment
# –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

### –®–∞–≥ 5: –í–∫–ª—é—á–∏—Ç—å vector search

```bash
# –í .env –¥–æ–±–∞–≤–∏—Ç—å:
echo "ENABLE_VECTOR_SEARCH=true" >> .env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
npm start
# –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (FTS + vector)
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                  | –í—Ä–µ–º—è         | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ                    |
|---------------------------|---------------|-------------------------------|
| INSERT (FTS —Ç—Ä–∏–≥–≥–µ—Ä)      | ~1-5 –º—Å       | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏                 |
| UPDATE (FTS —Ç—Ä–∏–≥–≥–µ—Ä)      | ~1-5 –º—Å       | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏                 |
| FTS –ø–æ–∏—Å–∫                 | ~5-50 –º—Å      | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–î         |
| Embedding —á–µ—Ä–µ–∑ Ollama    | ~50-200 –º—Å    | –ó–∞ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å                |
| Embedding —á–µ—Ä–µ–∑ OpenAI    | ~100-500 –º—Å   | –ó–∞ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å                |
| Vector search             | ~10-100 –º—Å    | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω–¥–µ–∫—Å–∞ (HNSW/IVF)|
| Worker (1000 –∑–∞–ø–∏—Å–µ–π)     | ~1-3 –º–∏–Ω—É—Ç—ã   | –ß–µ—Ä–µ–∑ Ollama —Å batch=32       |

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è FTS (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

```sql
-- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç search_vector
UPDATE equipment SET name = '–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ' WHERE id = 'exc-001';
-- search_vector –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

### –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è embeddings (–≤—Ä—É—á–Ω—É—é)

```sql
-- –û–±–Ω—É–ª–∏—Ç—å embeddings
UPDATE equipment SET embedding = NULL WHERE category = '–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã';

-- –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
-- npm run embed:equipment
```

### –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏ embeddings

```sql
-- 1. –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
ALTER TABLE equipment 
  ALTER COLUMN embedding TYPE vector(1536); -- –¥–ª—è OpenAI

-- 2. –û–±–Ω—É–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ embeddings
UPDATE equipment SET embedding = NULL;

-- 3. –ò–∑–º–µ–Ω–∏—Ç—å .env
-- EMBED_MODEL=text-embedding-3-small

-- 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
-- npm run embed:equipment
```


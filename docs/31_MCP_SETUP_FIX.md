# Исправление настройки MCP сервера PostgreSQL

## Что было исправлено

1. **Скрипт `scripts/mcp-postgres.sh`** - теперь правильно формирует строку подключения и передаёт её как аргумент командной строки MCP серверу
2. **Пример конфигурации** - обновлён для использования абсолютного пути

## Шаги для настройки

### 1. Убедитесь, что файл `.cursor/mcp.json` существует и настроен правильно

Если файл `.cursor/mcp.json` использует `${workspaceFolder}`, обновите его на абсолютный путь:

```json
{
  "mcpServers": {
    "postgres": {
      "command": "bash",
      "args": [
        "/home/boris/dev/speq-ts/scripts/mcp-postgres.sh"
      ],
      "env": {}
    }
  }
}
```

### 2. Перезапустите Cursor

**ВАЖНО:** После изменения конфигурации MCP необходимо полностью перезапустить Cursor, чтобы изменения вступили в силу.

### 3. Проверьте работу MCP сервера

После перезапуска Cursor:

1. Откройте панель команд (`Cmd/Ctrl + Shift + P`)
2. Введите "MCP" и выберите команду для просмотра серверов
3. Убедитесь, что сервер `postgres` отображается и активен

### 4. Протестируйте работу

Задайте вопросы о базе данных в чате с AI:

- "Какие таблицы есть в базе данных?"
- "Покажи схему таблицы equipment"
- "Сколько записей в таблице equipment?"

Если AI может ответить на эти вопросы, значит MCP сервер работает корректно.

## Что изменилось в скрипте

Скрипт `scripts/mcp-postgres.sh` теперь:

1. Загружает переменные окружения из `.env`
2. Формирует строку подключения PostgreSQL в формате `postgresql://user:password@host:port/database`
3. Передаёт строку подключения как аргумент командной строки в MCP сервер (а не как переменную окружения)

## Устранение проблем

### MCP сервер не отображается

1. Проверьте, что файл `.cursor/mcp.json` существует и содержит правильную конфигурацию
2. **Перезапустите Cursor** (это критически важно!)
3. Проверьте логи Cursor в панели Output (View > Output)

### Ошибки подключения к БД

1. Убедитесь, что файл `.env` существует и содержит правильные данные:
   ```bash
   cat .env | grep PG
   ```

2. Проверьте подключение вручную:
   ```bash
   cd /home/boris/dev/speq-ts
   export $(cat .env | grep -v '^#' | grep -v '^$' | xargs)
   psql -h "$PGHOST" -U "$PGUSER" -d "$PGDATABASE" -c "SELECT 1;"
   ```

### Скрипт не запускается

Проверьте права на выполнение:
```bash
chmod +x scripts/mcp-postgres.sh
```

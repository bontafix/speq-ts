# –†–µ—à–µ–Ω–∏–µ: –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º –∫–∞—Ç–∞–ª–æ–≥–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç:
- –ß—Ç–æ –µ—Å—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ?
- –ö–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã?
- –ú–æ–∂–µ—Ç, –æ–Ω –æ—à–∏–±—Å—è –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏?

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–∫–∞–∫–∏–µ –µ—Å—Ç—å —Ç—Ä–∞–∫—Ç–æ—Ä–∞"
LLM: { "category": "–¢—Ä–∞–∫—Ç–æ—Ä" }
–†–µ–∑—É–ª—å—Ç–∞—Ç: 0 –Ω–∞–π–¥–µ–Ω–æ
‚ùå –ù–µ—Ç –ø–æ–¥—Å–∫–∞–∑–æ–∫!
```

## –†–µ—à–µ–Ω–∏–µ: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫

### –£—Ä–æ–≤–µ–Ω—å 1: Fallback –ø–æ–∏—Å–∫

–ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

```
category="–¢—Ä–∞–∫—Ç–æ—Ä" ‚Üí 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  ‚Üì
Fallback 1: –ò—Å–∫–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (fuzzy)
  ‚Üí –ù–∞–π–¥–µ–Ω–æ: "–¢—è–≥–∞—á–∏", "–°–∞–º–æ—Å–≤–∞–ª—ã"
  ‚Üì
Fallback 2: –ò—Å–∫–∞—Ç—å –ø–æ —Ç–µ–∫—Å—Ç—É
  ‚Üí text="–¢—Ä–∞–∫—Ç–æ—Ä" —á–µ—Ä–µ–∑ search_vector
  ‚Üì
Fallback 3: –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  ‚Üí "–ö—Ä–∞–Ω—ã (34), –¢—è–≥–∞—á–∏ (34), –°–∞–º–æ—Å–≤–∞–ª—ã (32), ..."
```

### –£—Ä–æ–≤–µ–Ω—å 2: –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞:

1. **–ù–µ –Ω–∞–π–¥–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è** ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ + –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ
2. **–ù–µ –Ω–∞–π–¥–µ–Ω –±—Ä–µ–Ω–¥** ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±—Ä–µ–Ω–¥—ã
3. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤** ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Å–ª–∞–±–∏—Ç—å
4. **–ü—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å** ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –£–ª—É—á—à–µ–Ω–Ω—ã–π SearchEngine

```typescript
// src/search/search.engine.ts

async search(query: SearchQuery): Promise<CatalogSearchResult> {
  const limit = query.limit ?? 10;

  // 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  let normalizedQuery = query;
  if (this.queryNormalizer && query.parameters) {
    await this.ensureDictionaryLoaded();
    const result = this.queryNormalizer.normalizeQuery(query);
    normalizedQuery = result.normalizedQuery;
  }

  // 2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–Ω–¥–µ–∫—Å –∫–∞—Ç–∞–ª–æ–≥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω
  await this.catalogIndex.ensureIndex();

  // 3. –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫ (FTS + Vector)
  const [ftsResults, vectorResults] = await this.executeSearch(normalizedQuery, limit);
  
  // 4. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ–º fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  if (ftsResults.length === 0 && vectorResults.length === 0) {
    return await this.handleNoResults(normalizedQuery, limit);
  }

  // 5. –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  const merged = this.hybridFusion(ftsResults, vectorResults, limit);
  
  return {
    items: merged,
    total: merged.length,
    usedStrategy: this.determineStrategy(ftsResults, vectorResults),
  };
}

/**
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
 */
private async handleNoResults(
  query: SearchQuery, 
  limit: number
): Promise<CatalogSearchResult> {
  const suggestions = this.generateSuggestions(query);
  
  // Fallback 1: –ü–æ–∏—Å–∫ –ø–æ –ø–æ—Ö–æ–∂–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  if (query.category) {
    const similarCategories = this.catalogIndex.findSimilarCategories(query.category, 5);
    
    if (similarCategories.length > 0) {
      // –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫–∞—Ç—å –ø–æ –ø–µ—Ä–≤–æ–π –ø–æ—Ö–æ–∂–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      const fallbackQuery = {
        ...query,
        category: similarCategories[0],
      };
      
      const fallbackResults = await this.equipmentRepository.fullTextSearch(
        fallbackQuery,
        limit
      );
      
      if (fallbackResults.length > 0) {
        return {
          items: fallbackResults,
          total: fallbackResults.length,
          usedStrategy: 'fallback',
          suggestions: {
            ...suggestions,
            similarCategories,
          },
          message: `–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${query.category}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è "${similarCategories[0]}"`,
        };
      }
    }
  }

  // Fallback 2: –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ category
  if (query.category && !query.text) {
    const textQuery = {
      ...query,
      text: query.category,
      category: undefined,
    };
    
    const textResults = await this.equipmentRepository.fullTextSearch(textQuery, limit);
    
    if (textResults.length > 0) {
      return {
        items: textResults,
        total: textResults.length,
        usedStrategy: 'fallback',
        suggestions,
        message: `–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É "${query.category}" –≤–º–µ—Å—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏`,
      };
    }
  }

  // Fallback 3: –ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
  return {
    items: [],
    total: 0,
    usedStrategy: 'none',
    suggestions,
    message: this.generateNoResultsMessage(query, suggestions),
  };
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø—Ä–æ—Å–∞
 */
private generateSuggestions(query: SearchQuery): CatalogSuggestions {
  const suggestions: CatalogSuggestions = {};

  // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  if (query.category) {
    const similarCategories = this.catalogIndex.findSimilarCategories(query.category, 5);
    if (similarCategories.length > 0) {
      suggestions.similarCategories = similarCategories;
    }
  }

  // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
  suggestions.popularCategories = this.catalogIndex.getPopularCategories(10);

  // –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
  suggestions.exampleQueries = [
    '—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä —Å –º–æ—â–Ω–æ—Å—Ç—å—é 100 –ª.—Å.',
    '–∫—Ä–∞–Ω—ã –≤ –ú–æ—Å–∫–≤–µ',
    '—Å–∞–º–æ—Å–≤–∞–ª—ã –≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å—é –æ—Ç 20 —Ç–æ–Ω–Ω',
    '–∞–≤—Ç–æ–±–µ—Ç–æ–Ω–æ—Å–º–µ—Å–∏—Ç–µ–ª–∏',
  ];

  return suggestions;
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ç–æ–º, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
 */
private generateNoResultsMessage(
  query: SearchQuery, 
  suggestions: CatalogSuggestions
): string {
  const parts: string[] = [];

  if (query.category) {
    parts.push(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${query.category}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.`);
    
    if (suggestions.similarCategories && suggestions.similarCategories.length > 0) {
      parts.push(`–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏—Å–∫–∞–ª–∏: ${suggestions.similarCategories.join(', ')}`);
    }
  } else if (query.text) {
    parts.push(`–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query.text}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.`);
  } else {
    parts.push('–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.');
  }

  if (suggestions.popularCategories && suggestions.popularCategories.length > 0) {
    const top3 = suggestions.popularCategories.slice(0, 3)
      .map(c => `${c.name} (${c.count})`)
      .join(', ');
    parts.push(`–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${top3}`);
  }

  return parts.join(' ');
}
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CLI

```typescript
// src/cli/index.ts

async function displaySearchResults(result: CatalogSearchResult) {
  if (result.items.length === 0) {
    console.log();
    console.log('‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (result.message) {
      console.log();
      console.log('üí°', result.message);
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
    if (result.suggestions) {
      console.log();
      console.log('üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:');
      
      // –ü–æ—Ö–æ–∂–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (result.suggestions.similarCategories?.length) {
        console.log();
        console.log('   –ü–æ—Ö–æ–∂–∏–µ:');
        result.suggestions.similarCategories.forEach(cat => {
          console.log(`   - ${cat}`);
        });
      }
      
      // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (result.suggestions.popularCategories?.length) {
        console.log();
        console.log('   –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ (—Ç–æ–ø-10):');
        result.suggestions.popularCategories.forEach((cat, i) => {
          console.log(`   ${i + 1}. ${cat.name} (${cat.count} —à—Ç.)`);
        });
      }
      
      // –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
      if (result.suggestions.exampleQueries?.length) {
        console.log();
        console.log('   –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:');
        result.suggestions.exampleQueries.forEach(example => {
          console.log(`   ‚Ä¢ ${example}`);
        });
      }
    }
  } else {
    // –û–±—ã—á–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ: ${result.total} (–°—Ç—Ä–∞—Ç–µ–≥–∏—è: ${result.usedStrategy})`);
    
    if (result.message) {
      console.log('üí°', result.message);
    }
    
    result.items.forEach((item, i) => {
      console.log(`\n${i + 1}. ${item.name}`);
      console.log(`   –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${item.category}`);
      console.log(`   –ë—Ä–µ–Ω–¥: ${item.brand}`);
      if (item.price) console.log(`   –¶–µ–Ω–∞: ${item.price}`);
    });
  }
}
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ HTTP API

```typescript
// src/http/server.ts

app.post('/api/v1/search', async (req, res) => {
  try {
    const query = req.body as SearchQuery;
    const result = await searchEngine.search(query);
    
    // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    const response = {
      items: result.items,
      total: result.total,
      strategy: result.usedStrategy,
      message: result.message,
      suggestions: result.suggestions,
    };
    
    res.json(response);
  } catch (error) {
    console.error('Search error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ù–µ –Ω–∞–π–¥–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è

```
–ó–∞–ø—Ä–æ—Å: "–∫–∞–∫–∏–µ –µ—Å—Ç—å —Ç—Ä–∞–∫—Ç–æ—Ä–∞"
LLM: { "category": "–¢—Ä–∞–∫—Ç–æ—Ä" }

–†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "items": [],
  "total": 0,
  "strategy": "none",
  "message": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è '–¢—Ä–∞–∫—Ç–æ—Ä' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ. –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –ö—Ä–∞–Ω—ã (34), –¢—è–≥–∞—á–∏ (34), –°–∞–º–æ—Å–≤–∞–ª—ã (32)",
  "suggestions": {
    "similarCategories": [],
    "popularCategories": [
      { "name": "–ö—Ä–∞–Ω—ã", "count": 34 },
      { "name": "–¢—è–≥–∞—á–∏", "count": 34 },
      { "name": "–°–∞–º–æ—Å–≤–∞–ª—ã", "count": 32 },
      // ... –µ—â–µ 7
    ],
    "exampleQueries": [
      "—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä —Å –º–æ—â–Ω–æ—Å—Ç—å—é 100 –ª.—Å.",
      "–∫—Ä–∞–Ω—ã –≤ –ú–æ—Å–∫–≤–µ",
      // ...
    ]
  }
}
```

**–í CLI:**
```
‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

üí° –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–¢—Ä–∞–∫—Ç–æ—Ä" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ. 
    –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –ö—Ä–∞–Ω—ã (34), –¢—è–≥–∞—á–∏ (34), –°–∞–º–æ—Å–≤–∞–ª—ã (32)

üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

   –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ (—Ç–æ–ø-10):
   1. –ö—Ä–∞–Ω—ã (34 —à—Ç.)
   2. –¢—è–≥–∞—á–∏ (34 —à—Ç.)
   3. –°–∞–º–æ—Å–≤–∞–ª—ã (32 —à—Ç.)
   4. –ì—É—Å–µ–Ω–∏—á–Ω—ã–µ –∫—Ä–∞–Ω—ã (26 —à—Ç.)
   5. –®–∞—Å—Å–∏ (21 —à—Ç.)
   6. –ê—Å—Ñ–∞–ª—å—Ç–æ—É–∫–ª–∞–¥—á–∏–∫–∏ (21 —à—Ç.)
   7. –í–∏–ª–æ—á–Ω—ã–µ –ø–æ–≥—Ä—É–∑—á–∏–∫–∏ (19 —à—Ç.)
   8. –ê–≤—Ç–æ–∫—Ä–∞–Ω—ã (19 —à—Ç.)
   9. –¢–µ–ª–µ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π –ø–æ–≥—Ä—É–∑—á–∏–∫ (18 —à—Ç.)
   10. –§—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–æ–≥—Ä—É–∑—á–∏–∫–∏ (17 —à—Ç.)

   –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
   ‚Ä¢ —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä —Å –º–æ—â–Ω–æ—Å—Ç—å—é 100 –ª.—Å.
   ‚Ä¢ –∫—Ä–∞–Ω—ã –≤ –ú–æ—Å–∫–≤–µ
   ‚Ä¢ —Å–∞–º–æ—Å–≤–∞–ª—ã –≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å—é –æ—Ç 20 —Ç–æ–Ω–Ω
   ‚Ä¢ –∞–≤—Ç–æ–±–µ—Ç–æ–Ω–æ—Å–º–µ—Å–∏—Ç–µ–ª–∏
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ—Ö–æ–∂–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞

```
–ó–∞–ø—Ä–æ—Å: "–ø–æ–∫–∞–∂–∏ –∫—Ä–∞–Ω"
LLM: { "category": "–∫—Ä–∞–Ω" }

Fallback:
1. –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ: ["–ö—Ä–∞–Ω—ã", "–ê–≤—Ç–æ–∫—Ä–∞–Ω—ã", "–ì—É—Å–µ–Ω–∏—á–Ω—ã–µ –∫—Ä–∞–Ω—ã"]
2. –ü—Ä–æ–±—É–µ–º –∏—Å–∫–∞—Ç—å –ø–æ "–ö—Ä–∞–Ω—ã"
3. –ù–∞—à–ª–∏ 34 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞!

–†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "items": [... 10 –∫—Ä–∞–Ω–æ–≤ ...],
  "total": 10,
  "strategy": "fallback",
  "message": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è '–∫—Ä–∞–Ω' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è '–ö—Ä–∞–Ω—ã'",
  "suggestions": {
    "similarCategories": ["–ö—Ä–∞–Ω—ã", "–ê–≤—Ç–æ–∫—Ä–∞–Ω—ã", "–ì—É—Å–µ–Ω–∏—á–Ω—ã–µ –∫—Ä–∞–Ω—ã"]
  }
}
```

**–í CLI:**
```
‚úÖ –ù–∞–π–¥–µ–Ω–æ: 10 (–°—Ç—Ä–∞—Ç–µ–≥–∏—è: fallback)
üí° –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–∫—Ä–∞–Ω" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è "–ö—Ä–∞–Ω—ã"

1. LIEBHERR LTM 1100-5.2
   –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ö—Ä–∞–Ω—ã
   –ë—Ä–µ–Ω–¥: LIEBHERR
   –¶–µ–Ω–∞: 15000000
...
```

### –ü—Ä–∏–º–µ—Ä 3: –¢–µ–∫—Å—Ç–æ–≤—ã–π fallback

```
–ó–∞–ø—Ä–æ—Å: "—á—Ç–æ-—Ç–æ —Å –±–µ—Ç–æ–Ω–æ–º"
LLM: { "text": "–±–µ—Ç–æ–Ω" }

–†–µ–∑—É–ª—å—Ç–∞—Ç: 14 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ search_vector
- –ë–µ—Ç–æ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ (14)
- –ë–µ—Ç–æ–Ω–Ω—ã–µ –∑–∞–≤–æ–¥—ã (10)
- –ë–µ—Ç–æ–Ω–æ–Ω–∞—Å–æ—Å—ã (15)
- –∏ —Ç.–¥.
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
class SearchEngine {
  private popularQueriesCache: Map<string, CatalogSearchResult> = new Map();
  
  async search(query: SearchQuery): Promise<CatalogSearchResult> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    const cacheKey = JSON.stringify(query);
    const cached = this.popularQueriesCache.get(cacheKey);
    
    if (cached && Date.now() - cached.timestamp < 60000) { // 1 –º–∏–Ω—É—Ç–∞
      return cached.result;
    }
    
    // ... –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫
  }
}
```

### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
private async handleNoResults(query: SearchQuery, limit: number) {
  // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  console.warn('[Search] No results for query:', JSON.stringify(query));
  
  // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  await this.logFailedQuery(query);
  
  // ... fallback –ª–æ–≥–∏–∫–∞
}
```

### 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫

```typescript
interface SuggestionStrategy {
  name: string;
  weight: number;
  generate: (query: SearchQuery) => CatalogSuggestions;
}

const strategies: SuggestionStrategy[] = [
  {
    name: 'popular',
    weight: 0.7,
    generate: (q) => ({ popularCategories: this.getPopular() }),
  },
  {
    name: 'similar',
    weight: 0.3,
    generate: (q) => ({ similarCategories: this.getSimilar(q.category) }),
  },
];
```

## –ú–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
1. **–î–æ–ª—è —É—Å–ø–µ—à–Ω—ã—Ö fallback** - —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ fallback –ø–æ–º–æ–≥ –Ω–∞–π—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
2. **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** - —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏—â—É—Ç, –Ω–æ –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç
3. **CTR –Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏** - –∫–ª–∏–∫–∞—é—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```typescript
interface SearchMetrics {
  totalSearches: number;
  successfulSearches: number;
  fallbackSearches: number;
  noResultsSearches: number;
  popularFailedQueries: Map<string, number>;
}
```

## –ò—Ç–æ–≥–æ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è:**

‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é  
‚úÖ Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —à–∞–Ω—Å –Ω–∞–π—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã  
‚úÖ –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–º–æ–≥–∞—é—Ç —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç —É–ª—É—á—à–∞—Ç—å —Å–∏—Å—Ç–µ–º—É  
‚úÖ –ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏  

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å `SearchEngine.search()` —Å fallback –ª–æ–≥–∏–∫–æ–π
2. –û–±–Ω–æ–≤–∏—Ç—å CLI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
3. –û–±–Ω–æ–≤–∏—Ç—å HTTP API –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ suggestions
4. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö


-- ============================================================================
-- Миграция 002: Пример тестовых данных для каталога оборудования
-- ============================================================================

-- Вставляем несколько примеров оборудования для тестирования
-- После вставки:
-- - search_vector заполнится АВТОМАТИЧЕСКИ (через триггер)
-- - embedding нужно заполнить через worker: npm run embed:equipment

INSERT INTO equipment (id, name, category, subcategory, brand, region, description, price, main_parameters) VALUES
  (
    'exc-001',
    'Гусеничный экскаватор Cat 320D',
    'Экскаваторы',
    'Гусеничные',
    'Caterpillar',
    'Москва',
    'Гусеничный экскаватор для карьерных и строительных работ. Мощный двигатель, большой ковш.',
    4500000,
    '{"тоннаж": 20, "объём_ковша": "1.2 м³", "мощность": "121 кВт"}'::jsonb
  ),
  (
    'exc-002',
    'Гусеничный экскаватор Komatsu PC200',
    'Экскаваторы',
    'Гусеничные',
    'Komatsu',
    'Санкт-Петербург',
    'Надёжный экскаватор для земляных работ. Экономичный расход топлива.',
    3800000,
    '{"тоннаж": 18, "объём_ковша": "1.0 м³", "мощность": "110 кВт"}'::jsonb
  ),
  (
    'exc-003',
    'Гусеничный экскаватор Hitachi ZX330',
    'Экскаваторы',
    'Гусеничные',
    'Hitachi',
    'Екатеринбург',
    'Тяжёлый экскаватор для карьеров и крупных строительных объектов.',
    5200000,
    '{"тоннаж": 30, "объём_ковша": "1.8 м³", "мощность": "190 кВт"}'::jsonb
  ),
  (
    'crane-001',
    'Гусеничный кран Liebherr LR 1600',
    'Краны',
    'Гусеничные',
    'Liebherr',
    'Москва',
    'Мощный гусеничный кран для подъёма тяжёлых грузов на большую высоту.',
    25000000,
    '{"грузоподъёмность": 600, "длина_стрелы": "120 м", "максимальная_высота": "154 м"}'::jsonb
  ),
  (
    'crane-002',
    'Гусеничный кран Zoomlion ZCC850V',
    'Краны',
    'Гусеничные',
    'Zoomlion',
    'Новосибирск',
    'Компактный гусеничный кран для работы в стесненных условиях.',
    18000000,
    '{"грузоподъёмность": 85, "длина_стрелы": "60 м"}'::jsonb
  ),
  (
    'bull-001',
    'Бульдозер Caterpillar D8T',
    'Бульдозеры',
    'Гусеничные',
    'Caterpillar',
    'Красноярск',
    'Тяжёлый бульдозер для перемещения больших объёмов грунта.',
    12000000,
    '{"мощность": "310 кВт", "ширина_отвала": "4.27 м", "вес": "37 тонн"}'::jsonb
  ),
  (
    'bull-002',
    'Бульдозер Shantui SD32',
    'Бульдозеры',
    'Гусеничные',
    'Shantui',
    'Владивосток',
    'Экономичный бульдозер китайского производства.',
    6500000,
    '{"мощность": "235 кВт", "ширина_отвала": "4.12 м", "вес": "35 тонн"}'::jsonb
  ),
  (
    'loader-001',
    'Фронтальный погрузчик Volvo L220H',
    'Погрузчики',
    'Колёсные',
    'Volvo',
    'Казань',
    'Колёсный погрузчик для быстрой погрузки сыпучих материалов.',
    8500000,
    '{"грузоподъёмность": 20, "объём_ковша": "3.5 м³", "мощность": "261 кВт"}'::jsonb
  ),
  (
    'drill-001',
    'Буровая установка Atlas Copco ROC D7',
    'Буровые установки',
    'Карьерные',
    'Atlas Copco',
    'Челябинск',
    'Мобильная буровая установка для карьерных работ.',
    15000000,
    '{"диаметр_бурения": "102-127 мм", "глубина_бурения": "40 м", "мощность": "220 кВт"}'::jsonb
  ),
  (
    'grader-001',
    'Автогрейдер Caterpillar 140M',
    'Автогрейдеры',
    NULL,
    'Caterpillar',
    'Ростов-на-Дону',
    'Автогрейдер для выравнивания дорожного полотна.',
    9800000,
    '{"мощность": "164 кВт", "длина_отвала": "3.7 м", "вес": "17 тонн"}'::jsonb
  )
ON CONFLICT (id) DO NOTHING;

-- Проверяем, что данные вставились и search_vector заполнился автоматически
SELECT 
  id, 
  name, 
  category,
  search_vector IS NOT NULL AS has_search_vector,
  embedding IS NOT NULL AS has_embedding
FROM equipment
ORDER BY id;

-- Результат должен показать:
-- has_search_vector = true  (заполнился автоматически)
-- has_embedding = false     (нужно запустить worker)

